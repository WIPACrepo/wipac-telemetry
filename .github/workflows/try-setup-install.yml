name: Try Setup Install

on: [push]

jobs:
  confirm-all-py-versions:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
      - run: |
          grep -P "\(\(\d+, ?\d+\), ?\(\d+, ?\d+\)\)" -oh setup.py | sed 's/ //g' | sed 's/,/./g' | grep -o -P "\d+\.\d+" > tmp.txt
          echo "setup.py-indicated python range: $(head -n1 tmp.txt) - $(tail -n1 tmp.txt)"
          echo "confirming min version in this GH Workflow..."
          grep "python-version: \['$(head -n1 tmp.txt)" .github/workflows/try-setup-install.yml
          echo "confirming max version in this GH Workflow..."
          grep "python-version: .*'$(tail -n1 tmp.txt)'\]" .github/workflows/try-setup-install.yml
          echo "all good, time for tests!"


  setup-py-install:
    needs: confirm-all-py-versions
    runs-on: ubuntu-latest

    strategy:
      matrix:
        python-version: ['3.6', '3.7', '3.8']

    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
        with:
          python-version: ${{ matrix.python-version }}
      - run: |
          echo ${{ matrix.python-version }}
          python setup.py install
